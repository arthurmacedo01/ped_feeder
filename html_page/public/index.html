<!DOCTYPE html>
<html>
  <head>
    <title>Interface</title>
    <meta name="viewport" content="width=device-width" />

    <!-- Latest compiled and minified CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css"
      integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu"
      crossorigin="anonymous"
    />

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.2/mqttws31.js"
      integrity="sha512-/DLt4+Ee4dtVAiyTMO7XsQ8ZCccddZRnVWPBeAtTdaT053JM2idaNP3o2thczXVqR6E8MjrLpqhY4x6om6nU7w=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script>
      client = new Paho.MQTT.Client(
        "test.mosquitto.org",
        8081,
        "",
        "clientBrowser-" + Math.floor(Math.random() * 10000)
      );
      client.onConnectionLost = onConnectionLost;
      client.onMessageArrived = onMessageArrived;
      client.connect({ onSuccess: onConnect, useSSL: true });

      function onConnect() {
        console.log("onConnect");
        client.subscribe("/exemploMQTTTASK/out");
        var sendButtonElement = document.getElementById("sendButton");
        sendButtonElement.classList.remove("btn-danger");
        sendButtonElement.classList.add("btn-success");
        sendButtonElement.disabled = false;
      }
      function onConnectionLost(responseObject) {
        if (responseObject.errorCode !== 0)
          console.log("onConnectionLost:" + responseObject.errorMessage);
        var sendButtonElement = document.getElementById("sendButton");
        sendButtonElement.classList.remove("btn-success");
        sendButtonElement.classList.add("btn-danger");
        sendButtonElement.disabled = true;
        client.connect({ onSuccess: onConnect });
      }
      function onMessageArrived(message) {
        console.log("onMessageArrived:" + message.payloadString);
        var msgTopElement = document.getElementById("msgTop");
        msgTopElement.textContent = message.payloadString;
      }

      function sendMsg(event) {
        event.preventDefault();
        var msgTopElement = document.getElementById("msgTop");
        msgTopElement.textContent = "...";
        data = {
          intensity: event.target.intensity.value,
        };
        message = new Paho.MQTT.Message(JSON.stringify(data));
        message.destinationName = "/exemploMQTTTASK/in";
        client.send(message);
      }
    </script>
    <style></style>
  </head>
  <body class="container">
    <h1 class="text-center">Alimentador</h1>
    <img src="./img.jpg" class="center-block" style="max-width: 100px" />
    <p class="text-center">Alimente o dog</p>

    <form onsubmit="sendMsg(event)">
      <div class="form-group">
        <label for="intensity" class="form-label">Intensidade:</label>
        <input
          type="range"
          id="intensity"
          class="form-range"
          min="0"
          max="300"
          value="100"
        />
      </div>

      <input
        type="submit"
        class="btn"
        value="Enviar"
        id="sendButton"
        disabled
      />
    </form>

    <p id="msgTop" class="text-center"></p>
  </body>
</html>
